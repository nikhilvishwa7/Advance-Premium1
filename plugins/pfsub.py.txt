group fsub code


@Client.on_message(filters.group & filters.text & filters.incoming)
async def give_filter(client, message):
    try:
        user_id = message.from_user.id if message.from_user else None
        chat_id = message.chat.id
        crazy_chatID = await db.get_chat(int(chat_id))

        is_verified = crazy_chatID.get('is_crazy_verified', False)

        if not is_verified:
            await client.send_message(message.chat.id, "<u>â‰ï¸ ğğ¨ğ­ğ¢ğœğ ğ€ğ¥ğğ«ğ­ </u> \n\n<b>âšœï¸ á´›ÊœÉªêœ± á´„Êœá´€á´› Éªêœ± É´á´á´› á´ á´‡Ê€Éªêœ°Éªá´‡á´… Êá´‡á´›. Éªêœ° Êá´á´œ á´€Ê€á´‡ á´€ É¢Ê€á´á´œá´˜ á´á´¡É´á´‡Ê€ á´Ê€ á´€á´…á´ÉªÉ´, á´˜ÊŸá´‡á´€êœ±á´‡ á´œêœ±á´‡ á´›Êœá´‡ /verify á´„á´á´á´á´€É´á´… á´›á´ Ê€á´‡Qá´œá´‡êœ±á´› á´ á´‡Ê€Éªêœ°Éªá´„á´€á´›Éªá´É´ êœ°á´Ê€ Êá´á´œÊ€ É¢Ê€á´á´œá´˜...</b>")
            return

        settings = await get_settings(chat_id)
        f_sub = settings.get('f_sub')

        if f_sub:
            try:
                member = await client.get_chat_member(f_sub, user_id)
                manual = await manual_filters(client, message)
                if not manual and settings.get('auto_ffilter', False):
                    await auto_filter(client, message)
                
            except UserNotParticipant:
                f_link = await client.export_chat_invite_link(f_sub)
                mks = await message.reply(
                    f"<b> âš ï¸ á´…á´‡á´€Ê€ {message.from_user.mention} â— \n\n ğŸ™ êœ°ÉªÊ€êœ±á´› á´Šá´ÉªÉ´ á´á´œÊ€ á´„Êœá´€É´É´á´‡ÊŸ á´›Êœá´‡É´ Êá´á´œ á´¡ÉªÊŸÊŸ É¢á´‡á´› á´á´á´ Éªá´‡, á´á´›Êœá´‡Ê€á´¡Éªêœ±á´‡ Êá´á´œ á´¡ÉªÊŸÊŸ É´á´á´› É¢á´‡á´› Éªá´›.\n\ná´„ÊŸÉªá´„á´‹ á´Šá´ÉªÉ´ á´„Êœá´€É´É´á´‡ÊŸ Ê™á´œá´›á´›á´É´ ğŸ‘‡</b>",
                    reply_markup=InlineKeyboardMarkup([
                        [InlineKeyboardButton("â›” á´Šá´ÉªÉ´ á´„Êœá´€É´É´á´‡ÊŸ â›”", url=f_link)],
                        [InlineKeyboardButton("â™»ï¸ á´›Ê€Ê á´€É¢á´€ÉªÉ´ â™»ï¸", callback_data='checkuser')]
                    ])
                )
                await asyncio.sleep(60)
                await mks.delete()
                return False
        else:
            if is_verified:
                manual = await manual_filters(client, message)
                if not manual:
                    try:
                        if settings.get('auto_ffilter', False):
                            await auto_filter(client, message)
                    except KeyError:
                        grpid = await active_connection(str(message.from_user.id))
                        await save_group_settings(grpid, 'auto_ffilter', True)
                        if settings.get('auto_ffilter', False):
                            await auto_filter(client, message)

            if f_sub is None and settings.get('auto_ffilter', False):
                await auto_filter(client, message)

    except Exception as e:
        logger.error(f"Error in processing message: {e}")
